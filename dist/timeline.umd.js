(function(v,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(v=typeof globalThis<"u"?globalThis:v||self,v.$timeline=d())})(this,function(){var J,L,P,w,U,Z,st,bt,nt,St,rt,Tt,at,Ft,ot,Ct,ht,Ht,G,Dt,R,mt,Q,wt;"use strict";var It=Object.defineProperty;var jt=(v,d,x)=>d in v?It(v,d,{enumerable:!0,configurable:!0,writable:!0,value:x}):v[d]=x;var it=(v,d,x)=>(jt(v,typeof d!="symbol"?d+"":d,x),x),Yt=(v,d,x)=>{if(!d.has(v))throw TypeError("Cannot "+x)};var f=(v,d,x)=>(Yt(v,d,"read from private field"),x?x.call(v):d.get(v)),F=(v,d,x)=>{if(d.has(v))throw TypeError("Cannot add the same private member more than once");d instanceof WeakSet?d.add(v):d.set(v,x)},A=(v,d,x,V)=>(Yt(v,d,"write to private field"),V?V.call(v,x):d.set(v,x),x);var _=(v,d,x)=>(Yt(v,d,"access private method"),x);function v(u){return{all:u=u||new Map,on:function(s,r){var n=u.get(s);n?n.push(r):u.set(s,[r])},off:function(s,r){var n=u.get(s);n&&(r?n.splice(n.indexOf(r)>>>0,1):u.set(s,[]))},emit:function(s,r){var n=u.get(s);n&&n.slice().map(function(l){l(r)}),(n=u.get("*"))&&n.slice().map(function(l){l(s,r)})}}}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function x(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var V={exports:{}};(function(u,s){(function(r,n){u.exports=n()})(d,function(){var r=1e3,n=6e4,l=36e5,p="millisecond",m="second",M="minute",Y="hour",y="day",C="week",H="month",O="quarter",W="year",z="date",ct="Invalid Date",$t=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ut=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,vt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var i=["th","st","nd","rd"],t=a%100;return"["+a+(i[(t-20)%10]||i[t]||i[0])+"]"}},I=function(a,i,t){var o=String(a);return!o||o.length>=i?a:""+Array(i+1-o.length).join(t)+a},K={s:I,z:function(a){var i=-a.utcOffset(),t=Math.abs(i),o=Math.floor(t/60),e=t%60;return(i<=0?"+":"-")+I(o,2,"0")+":"+I(e,2,"0")},m:function a(i,t){if(i.date()<t.date())return-a(t,i);var o=12*(t.year()-i.year())+(t.month()-i.month()),e=i.clone().add(o,H),c=t-e<0,h=i.clone().add(o+(c?-1:1),H);return+(-(o+(t-e)/(c?e-h:h-e))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:H,y:W,w:C,d:y,D:z,h:Y,m:M,s:m,ms:p,Q:O}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},j="en",B={};B[j]=vt;var pt=function(a){return a instanceof lt},ft=function a(i,t,o){var e;if(!i)return j;if(typeof i=="string"){var c=i.toLowerCase();B[c]&&(e=c),t&&(B[c]=t,e=c);var h=i.split("-");if(!e&&h.length>1)return a(h[0])}else{var $=i.name;B[$]=i,e=$}return!o&&e&&(j=e),e||!o&&j},S=function(a,i){if(pt(a))return a.clone();var t=typeof i=="object"?i:{};return t.date=a,t.args=arguments,new lt(t)},g=K;g.l=ft,g.i=pt,g.w=function(a,i){return S(a,{locale:i.$L,utc:i.$u,x:i.$x,$offset:i.$offset})};var lt=function(){function a(t){this.$L=ft(t.locale,null,!0),this.parse(t)}var i=a.prototype;return i.parse=function(t){this.$d=function(o){var e=o.date,c=o.utc;if(e===null)return new Date(NaN);if(g.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var h=e.match($t);if(h){var $=h[2]-1||0,b=(h[7]||"0").substring(0,3);return c?new Date(Date.UTC(h[1],$,h[3]||1,h[4]||0,h[5]||0,h[6]||0,b)):new Date(h[1],$,h[3]||1,h[4]||0,h[5]||0,h[6]||0,b)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},i.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},i.$utils=function(){return g},i.isValid=function(){return this.$d.toString()!==ct},i.isSame=function(t,o){var e=S(t);return this.startOf(o)<=e&&e<=this.endOf(o)},i.isAfter=function(t,o){return S(t)<this.startOf(o)},i.isBefore=function(t,o){return this.endOf(o)<S(t)},i.$g=function(t,o,e){return g.u(t)?this[o]:this.set(e,t)},i.unix=function(){return Math.floor(this.valueOf()/1e3)},i.valueOf=function(){return this.$d.getTime()},i.startOf=function(t,o){var e=this,c=!!g.u(o)||o,h=g.p(t),$=function(q,E){var N=g.w(e.$u?Date.UTC(e.$y,E,q):new Date(e.$y,E,q),e);return c?N:N.endOf(y)},b=function(q,E){return g.w(e.toDate()[q].apply(e.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(E)),e)},D=this.$W,T=this.$M,X=this.$D,k="set"+(this.$u?"UTC":"");switch(h){case W:return c?$(1,0):$(31,11);case H:return c?$(1,T):$(0,T+1);case C:var tt=this.$locale().weekStart||0,et=(D<tt?D+7:D)-tt;return $(c?X-et:X+(6-et),T);case y:case z:return b(k+"Hours",0);case Y:return b(k+"Minutes",1);case M:return b(k+"Seconds",2);case m:return b(k+"Milliseconds",3);default:return this.clone()}},i.endOf=function(t){return this.startOf(t,!1)},i.$set=function(t,o){var e,c=g.p(t),h="set"+(this.$u?"UTC":""),$=(e={},e[y]=h+"Date",e[z]=h+"Date",e[H]=h+"Month",e[W]=h+"FullYear",e[Y]=h+"Hours",e[M]=h+"Minutes",e[m]=h+"Seconds",e[p]=h+"Milliseconds",e)[c],b=c===y?this.$D+(o-this.$W):o;if(c===H||c===W){var D=this.clone().set(z,1);D.$d[$](b),D.init(),this.$d=D.set(z,Math.min(this.$D,D.daysInMonth())).$d}else $&&this.$d[$](b);return this.init(),this},i.set=function(t,o){return this.clone().$set(t,o)},i.get=function(t){return this[g.p(t)]()},i.add=function(t,o){var e,c=this;t=Number(t);var h=g.p(o),$=function(T){var X=S(c);return g.w(X.date(X.date()+Math.round(T*t)),c)};if(h===H)return this.set(H,this.$M+t);if(h===W)return this.set(W,this.$y+t);if(h===y)return $(1);if(h===C)return $(7);var b=(e={},e[M]=n,e[Y]=l,e[m]=r,e)[h]||1,D=this.$d.getTime()+t*b;return g.w(D,this)},i.subtract=function(t,o){return this.add(-1*t,o)},i.format=function(t){var o=this,e=this.$locale();if(!this.isValid())return e.invalidDate||ct;var c=t||"YYYY-MM-DDTHH:mm:ssZ",h=g.z(this),$=this.$H,b=this.$m,D=this.$M,T=e.weekdays,X=e.months,k=function(E,N,Mt,dt){return E&&(E[N]||E(o,c))||Mt[N].slice(0,dt)},tt=function(E){return g.s($%12||12,E,"0")},et=e.meridiem||function(E,N,Mt){var dt=E<12?"AM":"PM";return Mt?dt.toLowerCase():dt},q={YY:String(this.$y).slice(-2),YYYY:g.s(this.$y,4,"0"),M:D+1,MM:g.s(D+1,2,"0"),MMM:k(e.monthsShort,D,X,3),MMMM:k(X,D),D:this.$D,DD:g.s(this.$D,2,"0"),d:String(this.$W),dd:k(e.weekdaysMin,this.$W,T,2),ddd:k(e.weekdaysShort,this.$W,T,3),dddd:T[this.$W],H:String($),HH:g.s($,2,"0"),h:tt(1),hh:tt(2),a:et($,b,!0),A:et($,b,!1),m:String(b),mm:g.s(b,2,"0"),s:String(this.$s),ss:g.s(this.$s,2,"0"),SSS:g.s(this.$ms,3,"0"),Z:h};return c.replace(ut,function(E,N){return N||q[E]||h.replace(":","")})},i.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},i.diff=function(t,o,e){var c,h=g.p(o),$=S(t),b=($.utcOffset()-this.utcOffset())*n,D=this-$,T=g.m(this,$);return T=(c={},c[W]=T/12,c[H]=T,c[O]=T/3,c[C]=(D-b)/6048e5,c[y]=(D-b)/864e5,c[Y]=D/l,c[M]=D/n,c[m]=D/r,c)[h]||D,e?T:g.a(T)},i.daysInMonth=function(){return this.endOf(H).$D},i.$locale=function(){return B[this.$L]},i.locale=function(t,o){if(!t)return this.$L;var e=this.clone(),c=ft(t,o,!0);return c&&(e.$L=c),e},i.clone=function(){return g.w(this.$d,this)},i.toDate=function(){return new Date(this.valueOf())},i.toJSON=function(){return this.isValid()?this.toISOString():null},i.toISOString=function(){return this.$d.toISOString()},i.toString=function(){return this.$d.toUTCString()},a}(),xt=lt.prototype;return S.prototype=xt,[["$ms",p],["$s",m],["$m",M],["$H",Y],["$W",y],["$M",H],["$y",W],["$D",z]].forEach(function(a){xt[a[1]]=function(i){return this.$g(i,a[0],a[1])}}),S.extend=function(a,i){return a.$i||(a(i,lt,S),a.$i=!0),S},S.locale=ft,S.isDayjs=pt,S.unix=function(a){return S(1e3*a)},S.en=B[j],S.Ls=B,S.p={},S})})(V);var Lt=V.exports;const Ot=x(Lt);function Et(u,s){const r=_t(u),n=Wt(s,0,1),l={...r,a:n};return At(l)}function _t(u){const s=document.createElement("canvas");s.width=s.height=1;const r=s.getContext("2d");r.fillStyle=u,r.fillRect(0,0,1,1);const n=r.getImageData(0,0,1,1).data;return{r:n[0],g:n[1],b:n[2],a:n[3]/255}}function At(u){return`rgba(${u.r}, ${u.g}, ${u.b}, ${u.a})`}function Wt(u,s,r){return Math.min(Math.max(u,s),r)}const gt=(u,s="MM/DD HH:mm")=>Ot(u).format(s),yt=(u,s)=>{let r,n=0;return(...l)=>{const p=Date.now(),m=p-n;!n||m>=s?(n=p,u.apply(void 0,l)):r||(r=setTimeout(()=>{n=p,u.apply(void 0,l),r=null},s-m))}},Pt=({xCenterPoint:u,cfg:s,timePerPixel:r,timeSpacing:n,currentTime:l,$canvas:p,screenScaleCount:m,scaleHeight:M,startTime:Y,drawLine:y,drawText:C,drawArea:H})=>{const O=({space:W,scaleFormat:z,bgFormat:ct,currentFormat:$t})=>{C({x:p.width-u/10,y:6,text:gt(l,ct),fontSize:`${p.height-5}px`,align:"right",baseLine:"top",color:Et(s.textColor,.18)});const ut=Y%n,vt=ut/r;for(let I=0;I<m;I++){const K=I*s.scaleSpacing-vt-s.pointWidth/2,j=Y+I*n-ut;if(j%(n*W)===0){y({x:K,y:M.long}),C({x:K,y:p.height-M.long-5,text:gt(j,z),baseLine:"bottom"});continue}y({x:K,y:M.short})}y({x:u-s.pointWidth/2,y:p.height,width:s.pointWidth,color:s.pointColor}),H({startX:u-50,startY:4,endX:u+50,endY:18,bgColor:s.pointColor}),C({x:u,y:6,text:gt(l,$t),align:"center",baseLine:"top"})};n<100?O({space:10,scaleFormat:"mm:ss:SSS",bgFormat:"YYYY/MM/DD",currentFormat:"HH:mm:ss:SSS"}):n<1e3?O({space:10,scaleFormat:"mm:ss",bgFormat:"YYYY/MM/DD",currentFormat:"HH:mm:ss:SSS"}):n<1e4?O({space:10,scaleFormat:"mm:ss",bgFormat:"YYYY/MM/DD",currentFormat:"HH:mm:ss"}):n<6e4?O({space:12,scaleFormat:"HH:mm:ss",bgFormat:"YYYY/MM/DD",currentFormat:"HH:mm:ss"}):n<6e5?O({space:10,scaleFormat:"HH:mm:ss",bgFormat:"YYYY/MM/DD",currentFormat:"HH:mm:ss"}):n<36e5?O({space:12,scaleFormat:"MM/DD HH:mm",bgFormat:"YYYY/MM",currentFormat:"MM/DD HH:mm:ss"}):n<864e5?O({space:12,scaleFormat:"MM/DD HH:mm",bgFormat:"YYYY/MM",currentFormat:"YYYY/MM/DD HH:mm"}):n<6048e5?O({space:10,scaleFormat:"YYYY/MM/DD",bgFormat:"YYYY",currentFormat:"YYYY/MM/DD"}):O({space:10,scaleFormat:"YYYY/MM/DD",bgFormat:"YYYY",currentFormat:"YYYY/MM/DD"})},kt={fill:!0,bgColor:"rgba(0,0,0,0.5)",areaBgColor:"#ffffff55",textColor:"#ffffff",scaleColor:"#ffffff",pointColor:"#00aeec",pointWidth:3,scaleSpacing:7,fps:60,zoom:2,timeSpacingList:[10,100,1e3,1e4,6e4,6e5,36e5,864e5,6048e5]};class zt{constructor(s,r){F(this,st);F(this,nt);F(this,rt);F(this,at);F(this,ot);F(this,ht);F(this,G);F(this,R);F(this,Q);it(this,"$canvas");it(this,"ctx");it(this,"$canvasParent");it(this,"cfg");F(this,J,v());F(this,L,0);F(this,P,void 0);F(this,w,void 0);F(this,U,void 0);F(this,Z,!1);if(!s)throw new Error("canvas Element Or Element ID is required!");if(typeof s=="string"?this.$canvas=document.querySelector(s):this.$canvas=s,!(this.$canvas instanceof HTMLCanvasElement))throw new Error("element must be canvas!");this.ctx=this.$canvas.getContext("2d"),this.cfg={...kt,...r};const{fill:n,width:l,height:p,zoom:m,timeSpacingList:M,scaleHeight:Y}=this.cfg;if(m<0||m>=M.length||m%1!==0)throw new Error(`zoom must be 0 ~ ${M.length-1}, and must be an integer`);if(n){const y=this.$canvas.parentElement;this.$canvasParent=y,this.$canvas.width=y.clientWidth,this.$canvas.height=y.clientHeight,new ResizeObserver(yt(_(this,rt,Tt).bind(this),200)).observe(y)}else l&&(this.$canvas.width=l),p&&(this.$canvas.height=p);A(this,w,M[m]),Y!=null&&Y.long&&(Y!=null&&Y.short)?A(this,U,Y):A(this,U,{long:this.$canvas.height/3,medium:this.$canvas.height/6,short:this.$canvas.height/10}),this.$canvas.addEventListener("wheel",_(this,nt,St).bind(this),{passive:!1}),this.$canvas.addEventListener("mousedown",_(this,st,bt).bind(this))}draw({currentTime:s,areas:r,_privateFlag:n}={}){if(f(this,Z)&&!n)return;A(this,L,s||Date.now()),A(this,P,r||[]);const l=Math.ceil(this.$canvas.width/this.cfg.scaleSpacing),p=l*f(this,w),m=f(this,L)-p/2,M=f(this,L)+p/2,Y=this.$canvas.width/2,y=p/this.$canvas.width;_(this,at,Ft).call(this),_(this,R,mt).call(this,{startX:0,startY:0,endX:this.$canvas.width,endY:this.$canvas.height,bgColor:this.cfg.bgColor}),f(this,P).forEach(C=>{const H=C.startTime<m?0:Math.floor((C.startTime-m)/y),O=C.endTime>M?this.$canvas.width:Math.floor((C.endTime-m)/y);_(this,R,mt).call(this,{startX:H,startY:0,endX:O,endY:this.$canvas.height,bgColor:C.bgColor||this.cfg.areaBgColor})}),Pt.bind(this)({xCenterPoint:Y,screenScaleCount:l,startTime:m,timePerPixel:y,scaleHeight:f(this,U),timeSpacing:f(this,w),currentTime:f(this,L),$canvas:this.$canvas,cfg:this.cfg,drawLine:_(this,ht,Ht).bind(this),drawText:_(this,G,Dt).bind(this),drawArea:_(this,R,mt).bind(this)}),_(this,ot,Ct).call(this)}getCurrentTime(){return f(this,L)}on(s,r){f(this,J).on(s,r)}off(s,r){f(this,J).off(s,r)}}return J=new WeakMap,L=new WeakMap,P=new WeakMap,w=new WeakMap,U=new WeakMap,Z=new WeakMap,st=new WeakSet,bt=function(s){A(this,Z,!0);let r=0;const n=yt(({offsetX:m})=>{const M=m-s.offsetX,Y=f(this,L)-f(this,w)/this.cfg.scaleSpacing*(M-r);r=M,this.draw({currentTime:Math.round(Y),areas:f(this,P),_privateFlag:!0})},1e3/this.cfg.fps),l=({offsetX:m,offsetY:M})=>{(m<3||m>this.$canvas.width-3||M<3||M>this.$canvas.height-3)&&(this.$canvas.removeEventListener("mousemove",n),this.$canvas.removeEventListener("mousemove",l),A(this,Z,!1),_(this,Q,wt).call(this,"dragend",f(this,L)))},p=()=>{this.$canvas.removeEventListener("mousemove",n),this.$canvas.removeEventListener("mousemove",l),A(this,Z,!1),_(this,Q,wt).call(this,"dragend",f(this,L)),document.removeEventListener("mouseup",p)};this.$canvas.addEventListener("mousemove",n),this.$canvas.addEventListener("mousemove",l),document.addEventListener("mouseup",p)},nt=new WeakSet,St=function(s){s.preventDefault();const r=this.cfg.timeSpacingList.findIndex(n=>n===f(this,w));s.deltaY<0&&r>0?(A(this,w,this.cfg.timeSpacingList[r-1]),this.draw({currentTime:f(this,L),areas:f(this,P),_privateFlag:!0})):s.deltaY>0&&r<this.cfg.timeSpacingList.length-1&&(A(this,w,this.cfg.timeSpacingList[r+1]),this.draw({currentTime:f(this,L),areas:f(this,P),_privateFlag:!0}))},rt=new WeakSet,Tt=function(){this.$canvasParent&&(this.$canvas.width=this.$canvasParent.clientWidth,this.$canvas.height=this.$canvasParent.clientHeight,this.cfg.scaleHeight||A(this,U,{long:this.$canvas.height/3,medium:this.$canvas.height/6,short:this.$canvas.height/10}),this.draw({currentTime:f(this,L),areas:f(this,P)}))},at=new WeakSet,Ft=function(){this.ctx.clearRect(0,0,this.$canvas.width,this.$canvas.height)},ot=new WeakSet,Ct=function(){const s=()=>f(this,w)<1e3?`${f(this,w)}ms`:f(this,w)<6e4?`${Math.round(f(this,w)/100)/10}sec`:f(this,w)<36e5?`${Math.round(f(this,w)/100/60)/10}min`:f(this,w)<864e5?`${Math.round(f(this,w)/100/60/60)/10}hours`:f(this,w)<6048e5?`${Math.round(f(this,w)/100/60/60/24)/10}days`:`${Math.round(f(this,w)/100/60/60/24/7)/10}weeks`;_(this,G,Dt).call(this,{x:this.cfg.scaleSpacing+12,y:9,text:s(),align:"left",baseLine:"middle"}),this.ctx.beginPath(),this.ctx.moveTo(5,6),this.ctx.lineTo(5,10),this.ctx.lineTo(this.cfg.scaleSpacing+6,10),this.ctx.lineTo(this.cfg.scaleSpacing+6,6),this.ctx.strokeStyle=this.cfg.scaleColor,this.ctx.lineWidth=1.5,this.ctx.stroke()},ht=new WeakSet,Ht=function({x:s,y:r,width:n=1,color:l=this.cfg.scaleColor}){this.ctx.beginPath(),this.ctx.moveTo(s,this.$canvas.height),this.ctx.lineTo(s,this.$canvas.height-r),this.ctx.closePath(),this.ctx.strokeStyle=l,this.ctx.lineWidth=n,this.ctx.stroke()},G=new WeakSet,Dt=function({x:s,y:r,text:n,color:l=this.cfg.textColor,fontSize:p="11px",align:m="center",baseLine:M="alphabetic"}){this.ctx.beginPath(),this.ctx.font=`${p} Arial`,this.ctx.fillStyle=l,this.ctx.textAlign=m,this.ctx.textBaseline=M,this.ctx.fillText(n,s,r)},R=new WeakSet,mt=function({startX:s,startY:r,endX:n,endY:l,bgColor:p}){this.ctx.beginPath(),this.ctx.rect(s,r,n-s,l-r),this.ctx.fillStyle=p,this.ctx.fill()},Q=new WeakSet,wt=function(...s){f(this,J).emit(...s)},zt});
